"use strict";(self["webpackChunkdsk_ms_client"]=self["webpackChunkdsk_ms_client"]||[]).push([[599],{5599:function(e,t,r){r.r(t),r.d(t,{default:function(){return u}});var o=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"form",staticStyle:{width:"600px"},attrs:{"label-width":"120px",model:e.form,rules:e.rules}},[t("el-form-item",{attrs:{label:"封面图片",prop:"cover"}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{action:`${e.uploadURL}/upload`,"show-file-list":!1,"on-success":e.handleAvatarSuccess,"before-upload":e.beforeAvatarUpload}},[e.form.cover?t("img",{staticClass:"avatar",attrs:{src:e.form.cover}}):t("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),t("el-form-item",{attrs:{label:"图书类别",prop:"type_id"}},[t("el-radio",{attrs:{label:"1"},model:{value:e.form.type_id,callback:function(t){e.$set(e.form,"type_id",t)},expression:"form.type_id"}},[e._v("文学作品")]),t("el-radio",{attrs:{label:"2"},model:{value:e.form.type_id,callback:function(t){e.$set(e.form,"type_id",t)},expression:"form.type_id"}},[e._v("网络小说")]),t("el-radio",{attrs:{label:"3"},model:{value:e.form.type_id,callback:function(t){e.$set(e.form,"type_id",t)},expression:"form.type_id"}},[e._v("漫画绘本")])],1),t("el-form-item",{attrs:{label:"图书名称",prop:"title"}},[t("el-input",{attrs:{type:"text"},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t("el-form-item",{attrs:{label:"图书类型",prop:"type"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",placeholder:"请选择图书类型"},model:{value:e.form.type,callback:function(t){e.$set(e.form,"type",t)},expression:"form.type"}},e._l(e.types,(function(e){return t("el-option",{key:e.id,attrs:{label:e.typename,value:e.typename}})})),1)],1),t("el-form-item",{attrs:{label:"图书作者",prop:"author_name"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",remote:"","reserve-keyword":"",placeholder:"请输入关键词","remote-method":e.remoteMethod,loading:e.loading},model:{value:e.form.author_name,callback:function(t){e.$set(e.form,"author_name",t)},expression:"form.author_name"}},e._l(e.authors,(function(e){return t("el-option",{key:e.id,attrs:{label:e.author_name,value:e.author_name}})})),1)],1),t("el-form-item",{attrs:{label:"发布日期",prop:"publish_date"}},[t("el-date-picker",{staticStyle:{width:"100%"},attrs:{type:"date",placeholder:"选择日期","value-format":"yyyy-MM-dd"},model:{value:e.form.publish_date,callback:function(t){e.$set(e.form,"publish_date",t)},expression:"form.publish_date"}})],1),t("el-form-item",{attrs:{label:"图书评分",prop:"score"}},[t("el-input",{attrs:{type:"text"},model:{value:e.form.score,callback:function(t){e.$set(e.form,"score",t)},expression:"form.score"}})],1),t("el-form-item",{attrs:{label:"图书简介",prop:"description"}},[t("el-input",{attrs:{type:"textarea",rows:"3"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("立即更新")]),t("el-button",{on:{click:e.returnPage}},[e._v("取消")])],1)],1)],1)},a=[],s=(r(7658),r(3479)),l={data(){return{types:[],form:{bid:this.$route.params.id,type_id:"1",cover:"",title:"",type:[],author_name:"",publish_date:"",score:"",description:""},rules:{type_id:[{required:!0,message:"该字段不能为空",trigger:"blur"}],cover:[{required:!0,message:"该字段不能为空",trigger:"blur"}],title:[{required:!0,message:"该字段不能为空",trigger:"blur"}],type:[{required:!0,message:"该字段不能为空",trigger:"change"}],bookAuthor:[{required:!0,message:"该字段不能为空",trigger:"change"}],author_name:[{required:!0,message:"该字段不能为空",trigger:"change"}],publish_date:[{required:!0,message:"该字段不能为空",trigger:"blur"}],score:[{required:!0,message:"该字段不能为空",trigger:"blur"}],description:[{required:!0,message:"该字段不能为空",trigger:"blur"}]},authors:[],loading:!1}},methods:{returnPage(){if(window.history.length<=1)return this.$router.push({path:"/system/storageManagement"}),!1;this.$router.go(-1)},submit(){this.form.type=this.form.type.join("／"),console.log(this.form),this.$refs["form"].validate((e=>{e&&s.Z.bookAPI.update(this.form).then((e=>{200==e.data.code&&(this.$message.success("恭喜，更新成功"),this.$router.push("/home/book-list"))}))}))},remoteMethod(e){s.Z.authorAPI.queryByNameLike({name:e}).then((e=>{console.log("作者列表",e),this.authors=e.data.data}))},handleAvatarSuccess(e,t){console.log(e),this.form.cover=e.data},beforeAvatarUpload(e){const t="image/jpeg"===e.type,r=e.size/1024/1024<2;return t||this.$message.error("上传头像图片只能是 JPG 格式!"),r||this.$message.error("上传头像图片大小不能超过 2MB!"),t&&r},initBookTypes(){s.Z.bookAPI.queryTypes().then((e=>{console.log("加载所有图书类别",e),this.types=e.data.data}))}},mounted(){console.log(this.form.bid),s.Z.bookAPI.queryByBid({bid:this.form.bid}).then((e=>{console.log("通过id查询的图书详情是",e),this.form=e.data.data,this.form.type=this.form.type.split("／")})),this.initBookTypes()}},i=l,m=r(1001),n=(0,m.Z)(i,o,a,!1,null,"2c58d727",null),u=n.exports}}]);
//# sourceMappingURL=599.8cb559c7.js.map